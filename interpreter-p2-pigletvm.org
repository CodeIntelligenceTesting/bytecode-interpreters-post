#+OPTIONS: ^:nil num:nil p:nil timestamp:nil todo:nil date:nil creator:nil author:nil toc:nil
#+TITLE: Полет свиньи (или оптимизация интерпретаторов байт-кода)
* DONE развитая стековая машина

  - [X] чтение байт-кода из файла

  - [X] специальный нулевой байт-код

  - [X] ассемлер, дизассемблер

  - [X] система тестов

  - [X] 16 bit args in the machine

  - [X] 16 bit args in assembler/disassembler

  - [X] печать значений со стека

  - [X] JUMP

  - [X] EQUAL/LESS/LESS_OR_EQUAL/GREATER/GREATER_OR_EQUAL/

  - [X] asm/disasm update

  - [X] JUMP_IF_TRUE/JUMP_IF_FALSE

  - [X] метки в ассемблере (создание и использование в JUMP-ах)

  - [X] DUP

  - [X] массив памяти, загрузка на стек и обратно

  - [X] поддержка памяти в асм

  - [X] обновить Makefile

* DONE решето Эратосфена в ассемблере для ПятачокВМ

  sieve.pvm

* TODO простые оптимизации

  - [X] замерить скорость без оптимизаций

    default optimisation:

    x100 - 1.5 с

    -O3:

    x100 - 0.6 с

  - [X] сравнить с питоном

    x100 - 4.5 с

  - [X] оставить тэг для неоптимизированного кода

  - [X] отпрофилировать все толком

    17/13% на функции работы со стеком, по умолчанию не инлайнились

  - [X] макросы для работы со стеком

    1.5 -> 1.25ms

    теперь почти весь код работает через switch, который и занимает порядка 30% времени

  - [X] работа со стеком без замены значения

    1.25 -> 1.15ms

  - [ ] специальные байт-коды и нединамические суперинструкции

  - [ ] глянуть другие простые вещи?

  - [ ] разобрать вероятные улучшения switch

* TODO шитый код
* TODO кэш трасс
* TODO регистровая машина?
